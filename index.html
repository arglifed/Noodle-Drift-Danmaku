<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#050505">
    
    <title>Noodle Drift: Four Swords Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body { 
            margin: 0; 
            background: #050505; 
            color: #00ffff; 
            font-family: 'Press Start 2P', cursive; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            touch-action: none; 
        }
        
        .logo-container { text-align: center; margin-bottom: 20px; z-index: 10; pointer-events: none; }
        .logo-main { font-size: clamp(1.2rem, 8vw, 2.2rem); color: #fff; text-shadow: 3px 3px #ff00ff, 6px 6px #00ffff; letter-spacing: -2px; margin: 0; }
        .logo-sub { font-size: 0.6rem; color: #ff00ff; letter-spacing: 3px; margin-top: 8px; }

        canvas { 
            border: 4px solid #00ffff; 
            box-shadow: 0 0 20px #00ffff; 
            max-width: 90vw; 
            max-height: 65vh; 
            background: #000; 
            cursor: crosshair;
            display: block;
        }
        
        .score-box { color: #fff; font-size: 1rem; margin-top: 15px; text-shadow: 0 0 5px #ff00ff; }
        
        #highScoreBoard { 
            position: absolute; 
            right: 20px; 
            top: 50%; 
            transform: translateY(-50%); 
            background: rgba(0,0,0,0.9); 
            border: 2px solid #ff00ff; 
            padding: 15px; 
            font-size: 0.6rem; 
            line-height: 2; 
            color: #00ffff; 
            min-width: 150px; 
        }
        @media (max-width: 1100px) { #highScoreBoard { display: none; } }
    </style>
</head>
<body>

<div class="logo-container">
    <h1 class="logo-main">FOUR SWORDS</h1>
    <div class="logo-sub">RAMEN • ARCADE • DRIFT</div>
</div>

<canvas id="gameCanvas"></canvas>
<div id="scoreDisplay" class="score-box">SCORE: 000000</div>

<div id="highScoreBoard">
    <div style="color: #ff00ff; margin-bottom: 10px; text-align: center; border-bottom: 1px solid #ff00ff;">TOP DRIFTERS</div>
    <div id="scoreList"></div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreDisplay = document.getElementById('scoreDisplay');
const scoreList = document.getElementById('scoreList');

canvas.width = 450;
canvas.height = 700;

// Assets
let bowlLoaded = false;
const bowlImg = new Image();
bowlImg.onload = () => { bowlLoaded = true; };
bowlImg.src = 'bowl.png'; 

// Game State
let score = 0;
let gameActive = false;
let gameStarted = false;
let scrollPos = 0;
let speed = 4.5;
let frame = 0;
let highScores = JSON.parse(localStorage.getItem('fs_high_scores')) || [];

const player = { 
    x: 200, 
    y: 550, 
    w: 64, 
    h: 64, 
    vx: 0, 
    drifting: false, 
    rotation: 0, 
    hitboxRadius: 6 
};

let obstacles = [];
let medals = [];
let steam = [];
let grazes = [];

// Vibration Helper
const vibrate = (ms) => { if (navigator.vibrate) navigator.vibrate(ms); };

// Input Handling
const startDrift = (e) => { 
    if(e) e.preventDefault(); 
    if(!gameStarted) { gameStarted = true; gameActive = true; loop(); return; }
    if(!gameActive) { location.reload(); return; }
    player.drifting = true; 
};

const stopDrift = (e) => { 
    if(e) e.preventDefault(); 
    player.drifting = false; 
};

window.addEventListener('keydown', (e) => { if(e.code === 'Space') startDrift(); });
window.addEventListener('keyup', (e) => { if(e.code === 'Space') stopDrift(); });
canvas.addEventListener('mousedown', startDrift);
canvas.addEventListener('mouseup', stopDrift);
canvas.addEventListener('touchstart', startDrift, {passive: false});
canvas.addEventListener('touchend', stopDrift, {passive: false});

function updateScoresUI() {
    scoreList.innerHTML = highScores.length ? 
        highScores.map((s, i) => `<div>${i+1}. ${Math.floor(s).toString().padStart(6, '0')}</div>`).join('') :
        "<div style='text-align:center'>NO DATA</div>";
}

function saveHighScore(s) {
    highScores.push(s);
    highScores.sort((a, b) => b - a);
    highScores = highScores.slice(0, 5);
    localStorage.setItem('fs_high_scores', JSON.stringify(highScores));
    updateScoresUI();
}

function spawn() {
    const difficulty = Math.min(score / 20000, 1); 
    if (frame % Math.max(20, Math.floor(65 - (difficulty * 45))) === 0) {
        obstacles.push({ x: Math.random() * (canvas.width - 32), y: -50, w: 30, h: 30 });
    }
    if (frame % 25 === 0 && Math.random() < 0.3) {
        medals.push({ x: Math.random() * (canvas.width - 25), y: -50, w: 25, h: 25 });
    }
    if (frame % 4 === 0) {
        steam.push({ x: player.x + player.w/2 + (Math.random()*20-10), y: player.y + 40, size: 2 + Math.random()*6, life: 1.0 });
    }
}

function update() {
    if (!gameActive) return;
    frame++;
    speed = 4.5 + (score / 4000); 
    scrollPos = (scrollPos + speed) % 80; 
    score += 0.5;

    if (player.drifting) {
        player.vx += 1.1; 
        player.rotation = Math.min(player.rotation + 0.1, 0.45);
    } else {
        player.vx -= 1.1;
        player.rotation = Math.max(player.rotation - 0.1, -0.45);
    }
    player.vx *= 0.92; 
    player.x += player.vx;

    if (player.x < -15 || player.x > canvas.width - player.w + 15) {
        gameOver();
    }

    const px = player.x + player.w/2;
    const py = player.y + player.h/2;

    obstacles.forEach((obs, i) => {
        obs.y += speed;
        const dist = Math.hypot(px - (obs.x + obs.w/2), py - (obs.y + obs.h/2));
        if (dist < player.hitboxRadius + 12) {
            gameOver();
        } else if (dist < 45 && frame % 4 === 0) {
            score += 20; 
            vibrate(10);
            grazes.push({ x: px + 15, y: py - 25, life: 1.0 });
        }
        if (obs.y > canvas.height) obstacles.splice(i, 1);
    });

    medals.forEach((m, i) => {
        m.y += speed;
        if (Math.hypot(px - (m.x + m.w/2), py - (m.y + m.h/2)) < 35) {
            score += 1000; 
            vibrate(30);
            medals.splice(i, 1);
        }
        if (m.y > canvas.height) medals.splice(i, 1);
    });

    steam.forEach((p, i) => { p.y += speed * 0.1; p.life -= 0.02; if (p.life <= 0) steam.splice(i, 1); });
    grazes.forEach((g, i) => { g.y -= 2; g.life -= 0.05; if (g.life <= 0) grazes.splice(i, 1); });
    
    scoreDisplay.innerText = `SCORE: ${Math.floor(score).toString().padStart(6, '0')}`;
}

function gameOver() {
    gameActive = false;
    vibrate([100, 50, 100]);
    saveHighScore(score);
}

function draw() {
    ctx.fillStyle = '#050505';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.lineWidth = 1;
    for (let y = scrollPos - 80; y < canvas.height; y += 80) {
        ctx.strokeStyle = `rgba(255, 0, 255, ${0.1 + (y/canvas.height) * 0.3})`;
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
    }

    steam.forEach(p => {
        ctx.fillStyle = `rgba(0, 255, 255, ${p.life * 0.3})`;
        ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
    });

    ctx.save();
    ctx.translate(player.x + player.w/2, player.y + player.h/2);
    ctx.rotate(player.rotation);
    if(bowlLoaded) {
        ctx.drawImage(bowlImg, -player.w/2, -player.h/2, player.w, player.h);
    } else {
        ctx.strokeStyle = '#0ff'; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.arc(0, 0, 25, 0.1, Math.PI-0.1); ctx.stroke();
        ctx.strokeRect(-15, 15, 30, 5);
    }
    ctx.fillStyle = '#fff'; ctx.shadowBlur = 10; ctx.shadowColor = '#fff';
    ctx.beginPath(); ctx.arc(0, 0, player.hitboxRadius, 0, Math.PI*2); ctx.fill();
    ctx.restore(); ctx.shadowBlur = 0;

    obstacles.forEach(obs => {
        ctx.fillStyle = '#0ff'; ctx.shadowBlur = 10; ctx.shadowColor = '#0ff';
        ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
        ctx.strokeStyle = '#fff'; ctx.strokeRect(obs.x+2, obs.y+2, obs.w-4, obs.h-4);
    });

    medals.forEach(m => {
        ctx.fillStyle = '#ff0'; ctx.shadowColor = '#ff0'; ctx.shadowBlur = 15;
        ctx.beginPath(); ctx.arc(m.x + m.w/2, m.y + m.h/2, 10, 0, Math.PI*2); ctx.fill();
    });

    ctx.textAlign = "left";
    grazes.forEach(g => {
        ctx.fillStyle = `rgba(255, 255, 255, ${g.life})`;
        ctx.font = '8px "Press Start 2P"';
        ctx.fillText("GRAZE!!", g.x, g.y);
    });

    if (!gameStarted) {
        ctx.fillStyle = 'rgba(0,0,0,0.7)';
        ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = '#00ffff'; ctx.font = '14px "Press Start 2P"'; ctx.textAlign = "center";
        ctx.fillText("HOLD SCREEN TO DRIFT", canvas.width/2, 320);
        ctx.fillStyle = '#fff'; ctx.font = '10px "Press Start 2P"';
        ctx.fillText("TAP TO START", canvas.width/2, 380);
    } else if (!gameActive) {
        ctx.fillStyle = 'rgba(0,0,0,0.85)';
        ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = '#ff00ff'; ctx.font = '20px "Press Start 2P"'; ctx.textAlign = "center";
        ctx.fillText("DRIFT OVER", canvas.width/2, 300);
        ctx.font = '10px "Press Start 2P"'; ctx.fillStyle = '#fff';
        ctx.fillText("TAP TO REBOOT", canvas.width/2, 350);
    }
}

function loop() {
    update(); draw(); spawn();
    if (gameActive) requestAnimationFrame(loop);
}

updateScoresUI();
draw(); 
</script>
</body>
</html>